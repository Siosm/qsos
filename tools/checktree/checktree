#!/bin/sh
# $Id: checktree,v 1.2 2006/04/24 16:20:28 goneri Exp $
# Gonéri Le Bouder

DIR=`pwd`
SHOWTEMPLATE=$DIR"/../showtemplate/showtemplate.pl"
SYNCSECTIONDESC=$DIR"/../syncglobaldesc/syncglobaldesc"
cd ../../sheet/
if [ ! -f "global.xml" ]; then
  echo "global.xml doesn't exist in this tree"
  exit 1
fi

# First i try to sync file desc*
for file in `find -name '*.qsos' -type f|grep -v template`;do
  echo "syncing desc: $file"
  $SYNCSECTIONDESC -t global.xml -f $file
done
 
# now i do the diff
for file in `find -name '*.qsos' -type f|grep -v template`;do
  $SHOWTEMPLATE --global -f $file > `dirname $file`/global.tmp

  #diff -E -b global.xml `dirname $file`/global.tmp > /tmp/diff.`basename $file`.$$ 
  diff -E -u -b global.xml `dirname $file`/global.tmp > /tmp/diff.`basename $file`.$$.diff 
  if [ "$?" -ne "0" ];then
    echo
    echo "# Problem with $file"
    echo \#file global section differe from the global.xml section#: /tmp/diff.`basename $file`.$$.diff
#    cat /tmp/diff.`basename $file`.$$
  fi
  rm `dirname $file`/global.tmp
done
