<project name="JQEditor" default="jar-jqeditor" basedir=".">
	<!-- project's properties -->
	<property name="appname" value="JQEditeur"/>
	<property name="lib" value="lib"/>
	<property name="src" value="src"/>			
	<property name="share" value="share"/>
	<property name="dist" value="dist"/>
	<property name="dist.windows" value="${dist}/win32"/>	
	<property name="out" value="out"/>
	<property name="out.classes" value="out"/>
	<property name="out.lib" value="out"/>


	<!-- init -->
	<target name="init" depends="clean">
		<mkdir dir="${out}"/>
		<mkdir dir="${out.classes}"/>
		<mkdir dir="${out.lib}"/>
		<mkdir dir="${dist}"/>

		<path id="classpath">
			<fileset dir="${lib}">
				<include name="*.jar" />
			</fileset>
		</path>
	</target>

	<!-- COMPILE -->
	<target name="build" depends="init" description="compil all java classes">
	 	<javac 	compiler="gcj"
			srcdir="${src}"
	 		destdir="${out}">
	 		<classpath refid="classpath" />
	 	</javac>
		<copy todir="${out}">
          	<fileset dir="${src}">
            	<include name="**/*.properties"/>
        	</fileset>
		</copy>
	</target>
		
	<!-- JAR -->
	<target name="jar-jqeditor" depends="build">
		<jar destfile="${dist}/jqeditor.jar" >
			<manifest>
			    <attribute name="Built-By" value="${user.name}"/>
			    <section name="common">
			      <attribute name="Main-Class" value="org.qsos.main.JQ"/>
			    </section>
			  </manifest>
			<fileset dir="${out.classes}">
				<include name="**/*.class"/>
				<include name="**/*.properties"/>
			</fileset>
			
		</jar>
	</target>
	
	<!-- all -->
	<target name="all" depends="clean,build">
		<antcall target="jar-jqeditor"/>
	</target>

	<target name="run" description="RUN the program">
		<java classname="org.qsos.main.JQ">
			<classpath>
				<path refid="classpath"/>
				<pathelement location="${dist}/jqeditor.jar"/>
			</classpath>
		</java>
	</target>


	<!-- Building the app directory for the windows distrib -->

	<target name="windows" depends="jar-jqeditor">
		<mkdir dir="${dist.windows}"/>

		<property name="target" value="${dist.windows}/${appname}"/>
		<property name="target.src" value="${target}/src"/>
       		<property name="target.lib" value="${target}/lib"/>       
		<property name="target.share" value="${target}/share"/>

		<mkdir dir="${target}"/>
		<mkdir dir="${target.lib}"/>
		<mkdir dir="${target.share}"/>
		<mkdir dir="${target.src}"/>

		<!-- Copying source to the app's src dir -->
		<copy todir="${target.src}">
                	<fileset dir="${src}">
                        	<include name="**/*.java"/>
                	</fileset>
		</copy>

		<!-- Adding jar to the main directory -->

		<copy 	file="${dist}/jqeditor.jar"
			tofile="${target}/jqeditor.jar"/>


		<copy todir="${target.lib}">
			<fileset dir="${lib}">
				<include name="**/*.jar"/>
			</fileset>
                </copy>

		<!-- Adding windows dll for SWT -->
		<copy todir="${target}">
        	<fileset dir="${share}">
            	<include name="swt-win32-3139.dll"/>
            </fileset>
        </copy>
		<!-- Adding resources -->
		<copy todir="${target.share}">
			<fileset dir="${share}">
				<include name="**/*.png"/>
				<include name="**/*.bmp"/>
   				<include name="**/*.jpg"/>
				<include name="**/*.ico"/>
			</fileset>
		</copy>
	</target>

	<target name="clean">
		<delete failonerror="false">
			<fileset dir="${dist}"/>
			<fileset dir="${out}"/>
		</delete>
		<delete dir="${dist}"/>
		<delete dir="${out}"/>
	</target>
<!--
	<copy todir="${out}">
		<fileset dir="${src}">
			<exclude name="**/*.java"/>
		</fileset>
	</copy> -->
</project>
